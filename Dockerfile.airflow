# Image Airflow avec dépendances pour le traitement de factures (PDF → image, Tesseract)
FROM apache/airflow:2.8.1

USER root
RUN apt-get update -qq \
    && apt-get install -y -qq --no-install-recommends \
        poppler-utils \
        tesseract-ocr \
        tesseract-ocr-fra \
        tesseract-ocr-eng \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

USER airflow
RUN pip install --no-cache-dir \
    pillow \
    requests \
    openpyxl \
    pytesseract \
    pdf2image \
    pymupdf \
    openai
